(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function o(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=o(i);fetch(i.href,s)}})();const d=7,u=6,$=u+1,k=[3,2,4,1,5,0,6],M=1e6,Z=1400,m=document.getElementById("game-canvas"),a=m.getContext("2d"),G=document.getElementById("menu-overlay"),R=document.getElementById("toast"),tt=document.getElementById("mode-label"),et=document.getElementById("turn-label"),w=document.getElementById("status-label"),nt=document.getElementById("bot-label"),ot=document.getElementById("play-bot"),rt=document.getElementById("play-pvp"),H=document.getElementById("undo-btn"),it=document.getElementById("restart-btn"),st=document.getElementById("home-btn"),P={boardLight:"#1a233a",boardDark:"#0d1527",player1:"#ef4444",player2:"#34d399",star:"#fdfdfd",highlight:"rgba(90, 240, 217, 0.7)"},n={grid:N(),playerBoards:[0n,0n],heights:Array(d).fill(0),currentPlayer:1,gameType:"menu",status:"menu",winner:null,hoverCol:-1,aiThinking:!1,history:[],lastMove:null,anim:null},at=yt(),A=ht(),_=new Map;function N(){return Array.from({length:u},()=>Array(d).fill(0))}function E(t){n.grid=N(),n.playerBoards=[0n,0n],n.heights=Array(d).fill(0),n.currentPlayer=1,n.gameType=t,n.status="playing",n.winner=null,n.hoverCol=-1,n.aiThinking=!1,n.history=[],n.lastMove=null,n.anim=null,G.classList.add("hidden"),T(),g(),t==="bot"&&n.currentPlayer===2&&U()}function lt(){n.status="menu",n.gameType="menu",G.classList.remove("hidden"),T(),g()}ot.addEventListener("click",()=>E("bot"));rt.addEventListener("click",()=>E("pvp"));it.addEventListener("click",()=>{n.gameType!=="menu"&&E(n.gameType)});st.addEventListener("click",lt);H.addEventListener("click",()=>{n.gameType==="bot"&&K()});m.addEventListener("mousemove",t=>{const e=X(t);n.hoverCol=e,g()});m.addEventListener("mouseleave",()=>{n.hoverCol=-1,g()});m.addEventListener("click",t=>{if(n.status!=="playing"||n.aiThinking)return;const e=X(t);e<0||e>=d||n.gameType==="bot"&&n.currentPlayer===2||z(e)});document.addEventListener("keydown",t=>{t.key==="f"?Tt():t.key==="u"?n.gameType==="bot"&&K():t.key==="r"&&n.gameType!=="menu"&&E(n.gameType)});window.addEventListener("resize",V);V();g();T();function X(t){const e=m.getBoundingClientRect(),o=t.clientX-e.left,r=e.width,i=r*.05,s=r-i*2,l=s/d,c=Math.floor((o-i)/l);return o<i||o>i+s?-1:c}function z(t){if(!x(n,t)||n.status!=="playing")return;const e=n.heights[t];ct(t,e,n.currentPlayer);const o=n.currentPlayer;n.lastMove={col:t,row:e,player:o},n.history.push({col:t,row:e,player:o,bit:L(t,e)}),n.currentPlayer=3-n.currentPlayer,D(n.playerBoards[o-1])?(n.status="won",n.winner=o,W(`Player ${o} wins!`)):n.history.length===d*u&&(n.status="draw",W("Board is full. Draw.")),T(),g(),n.status==="playing"&&n.gameType==="bot"&&n.currentPlayer===2&&U()}function K(){n.history.length===0||n.gameType!=="bot"||(n.aiThinking=!1,F(),n.currentPlayer===2&&n.history.length>0&&F(),n.status="playing",n.winner=null,T(),g(),W("Undid your last turn."))}function F(){const t=n.history.pop();t&&(n.currentPlayer=t.player,n.heights[t.col]-=1,n.grid[t.row][t.col]=0,n.playerBoards[t.player-1]&=~t.bit,n.lastMove=n.history[n.history.length-1]||null)}function ct(t,e,o){n.grid[e][t]=o,n.heights[t]+=1,n.playerBoards[o-1]|=L(t,e),n.anim={col:t,row:e,player:o,start:performance.now(),duration:450}}function x(t,e){return t.heights[e]<u}function L(t,e){return 1n<<BigInt(t*$+e)}function U(){n.aiThinking=!0,T(),g();const t={boards:[...n.playerBoards],heights:[...n.heights],current:n.currentPlayer-1,moves:[...n.history]},e=performance.now(),o=500+Math.random()*500,r=ft(t,Z),i=performance.now()-e,s=Math.max(0,o-i);setTimeout(()=>{if(n.aiThinking=!1,n.status!=="playing"||n.currentPlayer!==2){g(),T();return}z(r??ut());const l=performance.now()-e;w.textContent=`Bot searched depth ${O} in ${l.toFixed(0)}ms`},s)}function ut(){for(const t of k)if(x(n,t))return t;return 0}let O=0;function ft(t,e){O=0;const o={boards:[...t.boards],heights:[...t.heights],current:t.current,moves:t.moves.map(l=>({col:l.col,bit:l.bit,player:l.player}))},r=performance.now()+e;let i=k.find(l=>j(o,l)),s=-1/0;for(let l=2;l<=12;l++){const c=J(o,l,-M,M,r,0);if(c.timeout||(O=l,c.move!==null&&c.score>s&&(s=c.score,i=c.move),s>=M-10))break}return i}function j(t,e){return t.heights[e]<u}function dt(t,e){const o=t.heights[e],r=1n<<BigInt(e*$+o);return t.boards[t.current]|=r,t.heights[e]+=1,t.moves.push({col:e,bit:r}),t.current^=1,{row:o,bit:r}}function Y(t){const e=t.moves.pop();e&&(t.current^=1,t.heights[e.col]-=1,t.boards[t.current]&=~e.bit)}function J(t,e,o,r,i,s){if(performance.now()>i)return{timeout:!0,score:0,move:null};const l=t.current^1;if(t.moves.length&&D(t.boards[l]))return{score:-M+s,move:null,timeout:!1};if(t.moves.length===d*u)return{score:0,move:null,timeout:!1};if(e===0)return{score:mt(t),move:null,timeout:!1};const c=gt(t),f=_.get(c);let y=[...k];if(f&&f.depth>=e)return{score:f.score,move:f.bestMove,timeout:!1};f&&f.bestMove!==null&&(y=[f.bestMove,...k.filter(b=>b!==f.bestMove)]);let h=null,p=-M;for(const b of y){if(!j(t,b))continue;dt(t,b);const I=t.boards[t.current^1];let v;if(D(I))v=M-s;else{const S=J(t,e-1,-r,-o,i,s+1);if(S.timeout)return Y(t),S;v=-S.score}if(Y(t),v>p&&(p=v,h=b),o=Math.max(o,v),o>=r)break}return _.set(c,{depth:e,score:p,bestMove:h}),{score:p,move:h,timeout:!1}}function mt(t){const e=t.boards[t.current],o=t.boards[t.current^1];let r=0;for(const s of at){const l=C(e&s),c=C(o&s);if(l&&c||l===0&&c===0)continue;const f=[0,2,8,40,0];r+=f[l],r-=f[c]}const i=3;return r+=i*C(e&A),r-=i*C(o&A),r}function C(t){let e=0,o=t;for(;o;)o&=o-1n,e++;return e}function gt(t){return`${t.boards[0].toString(16)}|${t.boards[1].toString(16)}|${t.current}`}function yt(){const t=[];for(let e=0;e<d;e++)for(let o=0;o<u;o++)e<=d-4&&t.push(B([[e,o],[e+1,o],[e+2,o],[e+3,o]])),o<=u-4&&t.push(B([[e,o],[e,o+1],[e,o+2],[e,o+3]])),e<=d-4&&o<=u-4&&t.push(B([[e,o],[e+1,o+1],[e+2,o+2],[e+3,o+3]])),e<=d-4&&o>=3&&t.push(B([[e,o],[e+1,o-1],[e+2,o-2],[e+3,o-3]]));return t}function B(t){return t.reduce((e,[o,r])=>e|L(o,r),0n)}function ht(){let t=0n;for(let e=0;e<u;e++)t|=L(3,e);return t}function D(t){const e=[1n,7n,6n,8n];for(const o of e){const r=t&t>>o;if(r&r>>2n*o)return!0}return!1}function V(){const t=m.parentElement.getBoundingClientRect(),e=window.devicePixelRatio||1;m.width=t.width*e,m.height=t.height*e,g()}function g(){const t=window.devicePixelRatio||1;a.save(),a.setTransform(t,0,0,t,0,0),a.clearRect(0,0,m.width,m.height);const e=m.width/t,o=m.height/t,r=e*.05,i=e-r*2,s=o-r*2,l=Math.min(i/d,s/u),c=r+(i-l*d)/2,f=r+(s-l*u)/2,y=a.createLinearGradient(0,0,e,o);y.addColorStop(0,"#0a0f1f"),y.addColorStop(1,"#0b132b"),a.fillStyle=y,a.fillRect(0,0,e,o);const h=18;if(a.fillStyle=P.boardDark,Q(a,c-14,f-14,l*d+28,l*u+28,h),a.fill(),a.save(),a.translate(c,f),pt(l),bt(l),vt(l),a.restore(),(n.status==="won"||n.status==="draw")&&Pt(e,o),a.restore(),n.anim){const p=performance.now();Math.min(1,(p-n.anim.start)/n.anim.duration)<1?requestAnimationFrame(g):n.anim=null}}function pt(t){a.fillStyle=P.boardLight,Q(a,0,0,t*d,t*u,14),a.fill(),a.globalCompositeOperation="destination-out";for(let e=0;e<d;e++)for(let o=0;o<u;o++)a.beginPath(),a.arc(e*t+t/2,(u-1-o)*t+t/2,t*.4,0,Math.PI*2),a.fill();a.globalCompositeOperation="source-over"}function bt(t,e,o){for(let r=0;r<d;r++)for(let i=0;i<u;i++){const s=n.grid[i][r];if(s===0||n.anim&&n.anim.col===r&&n.anim.row===i)continue;const l=r*t+t/2,c=(u-1-i)*t+t/2;q(l,c,t,s,n.lastMove&&n.lastMove.col===r&&n.lastMove.row===i)}if(n.anim){const{col:r,row:i,player:s,start:l,duration:c}=n.anim,f=r*t+t/2,y=(u-1-i)*t+t/2,h=-t*1.2,p=performance.now(),b=Math.min(1,(p-l)/c),I=1-Math.pow(1-b,3),v=h+(y-h)*I;q(f,v,t,s,!0)}}function vt(t,e,o){if(n.status!=="playing"||n.aiThinking||n.hoverCol<0||n.hoverCol>=d||!x(n,n.hoverCol))return;const r=n.hoverCol,i=n.heights[r],s=(u-1-i)*t+t/2,l=r*t+t/2;a.strokeStyle=P.highlight,a.lineWidth=3,a.setLineDash([8,6]),a.beginPath(),a.arc(l,s,t*.42,0,Math.PI*2),a.stroke(),a.setLineDash([])}function q(t,e,o,r,i){const s=r===1?P.player1:P.player2;a.fillStyle=s,a.beginPath(),a.arc(t,e,o*.42,0,Math.PI*2),a.fill(),i&&(a.strokeStyle=P.highlight,a.lineWidth=3,a.beginPath(),a.arc(t,e,o*.47,0,Math.PI*2),a.stroke()),wt(t,e,o*.18,r===1?5:6)}function wt(t,e,o,r){const i=o*.5;a.fillStyle=P.star,a.beginPath();for(let s=0;s<r*2;s++){const l=s%2===0?o:i,c=s*Math.PI/r,f=t+l*Math.cos(c-Math.PI/2),y=e+l*Math.sin(c-Math.PI/2);s===0?a.moveTo(f,y):a.lineTo(f,y)}a.closePath(),a.fill()}function Pt(t,e){a.fillStyle="rgba(0,0,0,0.65)",a.fillRect(0,e*.35,t,120),a.fillStyle="#fff",a.font="32px 'Segoe UI', 'Avenir Next', sans-serif",a.textAlign="center";let o="Draw game";n.status==="won"&&(n.gameType==="bot"?o=n.winner===1?"You beat the bot!":"Bot wins!":o=n.winner===1?"Player 1 wins!":"Player 2 wins!"),a.fillText(o,t/2,e*.35+64)}function Q(t,e,o,r,i,s){t.beginPath(),t.moveTo(e+s,o),t.lineTo(e+r-s,o),t.quadraticCurveTo(e+r,o,e+r,o+s),t.lineTo(e+r,o+i-s),t.quadraticCurveTo(e+r,o+i,e+r-s,o+i),t.lineTo(e+s,o+i),t.quadraticCurveTo(e,o+i,e,o+i-s),t.lineTo(e,o+s),t.quadraticCurveTo(e,o,e+s,o),t.closePath()}function T(){tt.textContent=n.gameType==="bot"?"Bot duel":n.gameType==="pvp"?"Two player":"Menu",et.textContent=n.status==="playing"?n.currentPlayer===1?"Player 1 (red)":"Player 2 (gold)":"—",nt.textContent="Iterative deepening α-β",n.status==="won"?n.gameType==="bot"?w.textContent=n.winner===1?"You beat the bot!":"Bot wins!":w.textContent=`Player ${n.winner} wins`:n.status==="draw"?w.textContent="Draw":n.aiThinking?w.textContent="Bot is calculating…":n.status==="playing"?w.textContent="Your move":w.textContent="Waiting to start",H.disabled=n.gameType!=="bot"||n.history.length===0}function Tt(){document.fullscreenElement?document.exitFullscreen().catch(()=>{}):m.requestFullscreen().catch(()=>{})}function W(t){R.textContent=t,R.classList.add("visible"),setTimeout(()=>R.classList.remove("visible"),1600)}window.render_game_to_text=()=>{const t={mode:n.status,gameType:n.gameType,currentPlayer:n.currentPlayer,winner:n.winner,moves:n.history.length,board:n.grid.map((e,o)=>({rowIndex:o,cells:e})),availableColumns:n.heights.map((e,o)=>e<u?o:null).filter(e=>e!==null),note:"Rows indexed from bottom = 0, columns from left = 0."};return JSON.stringify(t)};window.advanceTime=t=>{g()};
